<template>

  <!-- üéØ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ôüéØ  -->

  <div class="navbar1 navbar-light bg-light">
    <div class="navbar-content1">
      <h4 class="navbar-brand1">{{ topic }}</h4>
      <div class="Group">
        <p>‡πÇ‡∏•‡∏Å‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏à‡∏ö‡∏™‡∏¥‡πâ‡∏ô ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏£‡∏π‡πâ ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏≤‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</p>
      </div>
      <div class="image-navbar-brand1">
        <img src="/img/PG1.png" alt="E-Learning KM">
      </div>
    </div>
  </div>


 <section class="courses">
  <div class="search_twoo">
    <div class="input-searchh">
      <div class="icon">
        <span class="fa fa-search"></span>
      </div>
      <input type="search" name="search" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" v-model="searchQuery"  >
    </div>
  </div>


  <!-- <section class="courses"> -->
    <div class="hontainer">
      <h2><i class="fa fa-book" style="font-size:30px; margin:1px 5px ;"></i> ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°{{ topic }} </h2>
      <p>‡∏£‡∏ß‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≠‡∏á{{ topic }}‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
      <div id="app">
        <div class="All">
          <h2 v-if="!showAllItems">
            <i class="fa fa-reorder" style="margin:1px 5px;"> </i> ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
            <a href="#" class="see-more" @click.prevent="toggleCards">‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <i class="fa fa-angle-right" style="margin:1px 5px;"></i></a>
          </h2>
          <h2 v-else>
            <i class="fa fa-angle-down" style="margin:1px 5px;"></i> ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            <a href="#" class="see-more" @click.prevent="toggleCards">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö <i class="fa fa-angle-down"style="margin:1px 5px;"></i></a>
          </h2>
        </div>
      </div>

        
      <div class="container">
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î -->
        <div class="courses-grid">
          <div class="course-card" data-toggle="modal" data-target="#myModal" v-for="item in filteredItems"
            :key="item.id" @click="loadModel(item)">
            <div class="img">
              <img :src="'/img/' + item.image" alt="">
            </div>
            <h3>{{ item.name }}</h3>
            <p>{{ item.subject }}</p>
            <div><a href="#" @click="goToLV(item.id)" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°</a></div>
          </div>

          <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î -->
          <div class="modal" id="myModal">
            <div class="modal-dialog">
              <div class="modal-content">

                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô)  -->
                <div class="modal-header">
                  <img :src="'/img/' + modalItem.image" alt="Header Image">
                  <h4 class="modal-title">{{ modalItem.name }}</h4>
                  <i class="fa fa-close close-icon" data-dismiss="modal"></i>
                </div>
                <div class="modal-body">
                  <div class="section">
                    <div class="section-title">
                      <i class="fa fa-book"></i>
                      <h5>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h5>
                    </div>
                    <div class="section-content">
                      <p>{{ modalItem.content }}</p>
                    </div>
                  </div>
                  <div class="section">
                    <div class="section-title">
                      <i class="fa fa-users"></i>
                      <h5>‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</h5>
                    </div>
                    <div class="section-content">
                      <p>{{ modalItem.teacher_name }}</p>
                    </div>
                  </div>
                  <div class="section">
                    <div class="section-title">
                      <i class="fa fa-pencil"></i>
                      <h5>‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h5>
                    </div>
                    <div style="white-space: pre-line;" class="section-content">
                      {{ modalItem.toppic_sub }}
                    </div>

                  </div>
                </div>
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î ‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á (btn ‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î)  -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-success" @click="goToLV(modalItem.id)">Open</button>
                  <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</template>



<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';

const route = useRoute();
const id = route.params.id;
var url = '';
if (id == "all") {
  url = '/api/card/';
}
else {
  url = '/api/cardgroup/' + id;
}

const { data: cardItems } = await useFetch(url)
const displayedItems = ref(cardItems.value);

const searchQuery = ref(''); // To hold the search query

// Function to filter items based on search query
const filteredItems = computed(() => {
  if (!searchQuery.value.trim()) {
    return cardItems.value || [];
  }
  const query = searchQuery.value.toLowerCase();
  return (cardItems.value || []).filter(item =>
    item.name.toLowerCase().includes(query) ||
    item.subject.toLowerCase().includes(query)
  );
});


const modalItem = ref({
  id: '',
  name: '',
  content: '',
  teacher_name: '',
  toppic_sub: '',
  image: ''
});

const goToLV = (id: string) => {
  const item = cardItems.value.find(item => item.id === id);
  if (item) {
    window.location.href = '/ListVD/' + id;
  }
};

const loadModel = (item: any) => {
  modalItem.value.id = item.id;  // Set the id for modalItem
  modalItem.value.name = item.name;
  modalItem.value.content = item.content;
  modalItem.value.teacher_name = item.teacher_name;
  modalItem.value.toppic_sub = item.toppic_sub;
  modalItem.value.image = item.image;
  console.log(modalItem);
  console.log(item.name);
};

const showAllItems = ref(false);
const toggleCards = () => {
  showAllItems.value = !showAllItems.value;
  if (showAllItems.value) {
    displayedItems.value = cardItems.value || [];
  } else {
    displayedItems.value = cardItems.value?.slice(0, 4) || [];
  }
};

const topicMapping: Record<string, string> = {
  '1': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á',
  '2': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£',
  '3': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏£‡∏´‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
  '4': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',
  '5': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
  '6': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á',
  '7': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ä‡∏≠‡∏¥‡∏™‡∏£‡∏¥‡∏¢‡∏≤‡∏†‡∏£‡∏ì‡πå',
  '8': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£',
  '9': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
  '10': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Ø',
  '11': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
};

const topicId = Array.isArray(id) ? id[0] : id;
const topic = topicMapping[topicId] || '‡∏£‡∏ß‡∏°‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ';

onMounted(() => {
  console.log(`‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${topic}`);
});

</script>
